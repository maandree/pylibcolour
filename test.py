#!/usr/bin/env python3

import sys
from lib import *

def compare(x, y):
    if isinstance(x, tuple) or isinstance(x, list):
        for a, b in zip(x, y):
            compare(a, b)
    else:
        if (x - y) ** 2 > 0.00000001:
            sys.exit(1)

#####

calced = CIEXYZ(sRGB((0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.2, 0.4, 0.6, -1.0, 2.0),
                     (0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.4, 0.6, 0.2, -1.0, 2.0),
                     (0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.6, 0.2, 0.4, -1.0, 2.0),
                     with_transfer = False)).get_params()

ref = tuple(zip((0.0000000000, 0.0000000000, 0.0000000000),
                (0.0950470559, 0.1000000000, 0.1088828736),
                (0.1900941117, 0.2000000000, 0.2177657473),
                (0.2851411676, 0.3000000000, 0.3266486209),
                (0.3801882235, 0.4000000000, 0.4355314946),
                (0.4752352793, 0.5000000000, 0.5444143682),
                (0.5702823352, 0.6000000000, 0.6532972418),
                (0.6653293911, 0.7000000000, 0.7621801155),
                (0.7603764469, 0.8000000000, 0.8710629891),
                (0.8554235028, 0.9000000000, 0.9799458628),
                (0.9504705587, 1.0000000000, 1.0888287364),
                (0.3337841839, 0.3719003058, 0.6217252737),
                (0.4156159469, 0.5285953663, 0.2693093179),
                (0.3911645395, 0.2995043280, 0.4155598921),
                (-0.9504705587, -1.0000000000, -1.0888287364),
                (1.9009411173, 2.0000000000, 2.1776574728)))

compare(calced, ref)

#####

calced = CIEXYZ(sRGB((0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.2, 0.4, 0.6, -1.0, 2.0),
                     (0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.4, 0.6, 0.2, -1.0, 2.0),
                     (0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.6, 0.2, 0.4, -1.0, 2.0),
                     with_transfer = True)).get_params()

ref = tuple(zip((0.0000000000, 0.0000000000, 0.0000000000),
                (0.0095264006, 0.0100228256, 0.0109131405),
                (0.0314651060, 0.0331047666, 0.0360454212),
                (0.0696114713, 0.0732389559, 0.0797446798),
                (0.1262874278, 0.1328683216, 0.1446708467),
                (0.2034398024, 0.2140411405, 0.2330541445),
                (0.3027693342, 0.3185467781, 0.3468428859),
                (0.4257997966, 0.4479884124, 0.4877826570),
                (0.5739201081, 0.6038273389, 0.6574645584),
                (0.7484121986, 0.7874122894, 0.8573571281),
                (0.9504705587, 1.0000000000, 1.0888287364),
                (0.1186425164, 0.1250525939, 0.3191927881),
                (0.1746805013, 0.2584561666, 0.0719966354),
                (0.1671988502, 0.1010111057, 0.1363697302),
                (-0.9504705587, -1.0000000000, -1.0888287364),
                (4.7084845390, 4.9538457516, 5.3938896100)))

compare(calced, ref)

#####

calced = sRGB(sRGB((-1.0000000000, 0.7977377330),
                   ( 0.0000000000, 1.0000000000),
                   ( 0.4845292045, 1.0832683112),
                   with_transfer = True), with_transfer = False).get_params()

ref = tuple(zip((-1.0, 0.0, 0.2,),
                ( 0.6, 1.0, 1.2)))

compare(calced, ref)

#####

calced = CIExyY(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                     with_transfer = False)).get_params()

ref = tuple(zip((0.3127266044, 0.3290231524, 0.0000000000),
                (0.3127266044, 0.3290231524, 0.2000000000),
                (0.3127266044, 0.3290231524, 0.5000000000),
                (0.3127266044, 0.3290231524, 1.0000000000),
                (0.3127266044, 0.3290231524, -1.0000000000),
                (0.3127266044, 0.3290231524, 2.0000000000),
                (0.2514552726, 0.2801699340, 0.5578504586)))

compare(calced, ref)

#####

calced = CIELAB(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                     with_transfer = False)).get_params()

ref = tuple(zip((0.0000000000, 0.0000000000, 0.0000000000),
                (51.8372115265, 0.0000572880, 0.0000452449),
                (76.0692610142, 0.0000777517, 0.0000614068),
                (100.0000000000, 0.0000979610, 0.0000773677),
                (-903.2962962963, -0.0022884792, -0.0018073955),
                (130.1508417878, 0.0001234232, 0.0000974772),
                (79.4913252710, -7.7913446823, -25.2954672426)))

compare(calced, ref)

#####

calced = YIQ(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                  with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.5445000000, -0.2750938296, 0.0299034723)))

compare(calced, ref)

#####

calced = YDbDr(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                    with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.5445000000, 0.5349000000, 0.4650000000)))

compare(calced, ref)

#####

calced = YUV(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                  with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.5445000000, 0.1742913001, -0.2143845090)))

compare(calced, ref)

#####

calced = YPbPr(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                    with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.5578800000, 0.3421200000, -0.2578800000)))

compare(calced, ref)

#####

calced = YCgCo(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                    (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                    with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.6000000000, 0.0000000000, -0.3000000000)))

compare(calced, ref)

#####

#calced = CIE1960UCS(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
#                         (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
#                         (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
#                         with_transfer = False)).get_params()
#
#ref = tuple(zip((0.1978399744, 0.3122242545, 0.0), ## FIXME <-- first one (in libcolour too)
#                (0.1978399744, 0.3122242545, 0.2),
#                (0.1978399744, 0.3122242545, 0.5),
#                (0.1978399744, 0.3122242545, 1.0),
#                (0.1978399744, 0.3122242545, -1.0),
#                (0.1978399744, 0.3122242545, 2.0),
#                (0.1716673499, 0.2869060744, 0.5578504586)))
#
#compare(calced, ref)

#####

#calced = CIEUVW(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
#                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
#                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
#                     with_transfer = False), u0 = 0.2, v0 = 0.3).get_params()
#
#ref = tuple(zip((.0, .0, -17.0000000000), ## FIXME <-- first one (in libcolour too)
#                (0.0668287022, -0.3782043389, -2.3799113089),
#                (-0.0798187160, 0.4517188529, 2.8425131496),
#                (-0.2246426644, 1.2713224648, 8.0000000000),
#                (1.1793739884, -6.6744429400, -42.0000000000),
#                (-0.4071094057, 2.3039583079, 14.4980262474),
#                (-1.3186114778, -0.6093958941, 3.5800269981)))
#
#compare(calced, ref)

#####

#calced = CIELUV(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
#                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
#                     (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
#                     with_transfer = False)).get_params()
#
#ref = tuple(zip((0.0, -0.0, 0.0), ## FIXME <-- first one (in libcolour too)
#                (51.8372115265, -0.0000000060, 0.0000000010),
#                (76.0692610142, -0.0000000088, 0.0000000014),
#                (100.0000000000, -0.0000000116, 0.0000000018),
#                (-903.2962962963, 0.0000001047, -0.0000000166),
#                (130.1508417878, -0.0000000151, 0.0000000024),
#                (79.4913252710, -27.0464558429, -39.2452259327)))
#
#compare(calced, ref)

#####

# TODO CIELChuv

#####

calced = YES(sRGB((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                  (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                  with_transfer = False)).get_params()

ref = tuple(zip((0.0, 0.0, 0.0),
                (0.2, 0.0, 0.0),
                (0.5, 0.0, 0.0),
                (1.0, 0.0, 0.0),
                (-1.0, 0.0, 0.0),
                (2.0, 0.0, 0.0),
                (0.5430000000, -0.1500000000, -0.2250000000)))

compare(calced, ref)

#####

calced = CIEUVW(CIEUVW((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))).get_params()

ref = ((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))

compare(calced, ref)

#####

calced = CIEUVW(CIEUVW((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
                       u0 = 0.2, v0 = 0.3), u0 = 0.3, v0 = 0.2).get_params()

ref = tuple(zip((0.0000000000, 0.0000000000, 0.0000000000),
                (-0.0600000000, 0.4600000000, 0.2000000000),
                (-0.1500000000, 1.1500000000, 0.5000000000),
                (-0.3000000000, 2.3000000000, 1.0000000000),
                (0.3000000000, -2.3000000000, -1.0000000000),
                (-0.6000000000, 4.6000000000, 2.0000000000),
                (-0.8700000000, 1.7700000000, 0.9000000000)))

compare(calced, ref)

#####

calced = CIELUV(CIELUV((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))).get_params()

ref = ((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))

compare(calced, ref)

#####

#calced = CIELUV(CIELUV((0.2, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3), ### FIXME
#                       (0.2, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
#                       (0.2, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9),
#                       white = CIEXYZ(0.4, 1.0, 0.6)), white = CIEXYZ(0.9, 0.8, 0.7)).get_params()
#
#ref = tuple(zip((0.0, -0.0, 0.0),
#                (0.2500000000, -0.2276744186, 0.3905813953),
#                (0.6250000000, -0.5691860465, 0.9764534884),
#                (1.2500000000, -1.1383720930, 1.9529069767),
#                (-1.2500000000, 1.1383720930, -1.9529069767),
#                (2.5000000000, -2.2767441860, 3.9058139535),
#                (0.3750000000, 0.0334883721, 1.3358720930)))
#
#compare(calced, ref)

#####

calced = CIELChuv(CIELChuv((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
                           (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
                           (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))).get_params()

ref = ((0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.3),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.6),
       (0.0, 0.2, 0.5, 1.0, -1.0, 2.0, 0.9))

compare(calced, ref)

#####

## TODO CIELChuv white=
## TODO CIELChuv one_revolution=
## TODO CIELChuv white= one_revolution=
